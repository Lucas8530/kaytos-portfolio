"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),t=require("path"),r=require("remark-mdx"),n=require("remark-parse"),s=require("unified");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=o(t),a=o(r),p=o(n),l=o(s),u=["@typescript-eslint/parser","@babel/eslint-parser","babel-eslint","espree"],c=["JSXElement","JSXFragment"],f=function(e){return c.includes(e.type)},m=function(e){if(e){if("string"==typeof e&&(e=require(e)),"object"==typeof e&&(e="parseForESLint"in e&&e.parseForESLint||"parse"in e&&e.parse),"function"!=typeof e)throw new TypeError("Invalid custom parser for `eslint-mdx`: "+e);return[e]}for(var t=[],r=0,n=u;r<n.length;r++){var s=n[r];try{var o=require(s),i="parseForESLint"in o?o.parseForESLint:o.parse;i&&t.push(i)}catch(e){}}return t},x=function(e){var t=e.start.offset,r=e.end.offset;return{range:[t,r],loc:e,start:t,end:r}},h=function(e,t){return"object"==typeof e&&e&&t.every((function(t){return t in e}))},d=function(e,t){for(var r=0,n=e.split("\n"),s=0;s<n.length;s++){var o=s+1,i=r+n[s].length;if(i>=t)return{line:o,column:t-r};r=i+1}},_=function(e,t){if(e&&"object"==typeof e)for(var r=0,n=Object.values(e);r<n.length;r++){var s=n[r];_(s,t)}if(!h(e,["loc","range"]))return e;var o=e.loc,i=o.start,a=o.end,p=e.range,l=p[0],u=p[1],c=[l+=t.offset,u+=t.offset];return Object.assign(e,{start:l,end:u,range:c,loc:{start:{line:t.line+i.line,column:i.column+(1===i.line?t.column:0)},end:{line:t.line+a.line,column:a.column+(1===a.line?t.column:0)}}})},v=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.reduce((function(e,t){return e.push.apply(e,Array.isArray(t)?t:null==t?[]:[t]),e}),[])},g=function(e){return e&&e[e.length-1]},E="(?:\\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\\s*=\\s*"+("(?:[^\"'=<>`\\u0000-\\u0020]+|'[^']*'|\"[^\"]*\"|"+"{.*}".replace(".","[\0-ï¿¿]")+")")+")?)",y="<[A-Za-z]*[A-Za-z0-9\\.\\-]*"+E+"*\\s*>",S="<\\s*\\/[A-Za-z]*[A-Za-z0-9\\.\\-]*\\s*>",T="<[A-Za-z]*[A-Za-z0-9\\.\\-]*"+E+"*\\s*\\/?>",N="\x3c!----\x3e|\x3c!--(?:-?[^>-])(?:-?[^-])*--\x3e",b=new RegExp("^(?:"+y+")$"),O=new RegExp("^(?:"+S+")$"),L=new RegExp("^(?:"+y+"[^<]*"+S+")$"),A=new RegExp("^(?:"+T+")$"),P=new RegExp("^(?:"+N+")$"),R=new RegExp("(\x3c!---*)([\\s\\S]*?)(-*--\x3e)"),C=new RegExp("(\x3c!---*)([\\s\\S]*?)(-*--\x3e)","g"),J=function(e){return b.test(e.trim())},j=function(e){return O.test(e.trim())},w=function(e){return P.test(e.trim())},z=function(e){return L.test(e.trim())},F=function(e){return A.test(e.trim())},X=function(){function t(e){var t=e.code,r=e.enter;this.code=t,this._enter=r}return t.prototype.combineLeftJsxNodes=function(t,r){var n,s=t[0].position.start,o=e.__assign({},g(t).position.end);return r&&(null===(n=r.position.indent)||void 0===n?void 0:n.length)>0&&(o.offset+=r.position.indent.reduce((function(e,t,r){return e+(r?t+1:0)}),0)),{type:"jsx",data:t[0].data,value:this.code.slice(s.offset,o.offset),position:{start:s,end:o}}},t.prototype.combineJsxNodes=function(t,r){var n=this,s=0,o=!1,i=[],a=t.length;return t.reduce((function(t,p,l){if("jsx"===p.type){var u=p.value;if(J(u))s++,o=!0,i.push(p);else{if(j(u))s--,i.push(p);else if(w(u)||F(u)||z(u))i.push(p);else{l||(s++,o=!0);try{i.push.apply(i,v(U.normalizeJsxNode(p,r)))}catch(e){if(!s){var c=p.position.start;throw Object.assign(new SyntaxError("unknown jsx node: "+JSON.stringify(u)),{lineNumber:c.line,column:c.column,index:c.offset})}i.push(p)}}if(!s){var f=i.findIndex((function(e){return"string"==typeof e.value&&J(e.value)}));-1===f?o?t.push(n.combineLeftJsxNodes(i,r)):t.push.apply(t,i):t.push.apply(t,e.__spreadArray(e.__spreadArray([],i.slice(0,f)),[n.combineLeftJsxNodes(i.slice(f),r)])),i.length=0}}}else s?i.push(p):t.push(p);return l===a-1&&i.length>0&&t.push(n.combineLeftJsxNodes(i,r)),t}),[])},t.prototype.traverse=function(e,t){if(e){var r=e.children;if(r)for(var n=e,s=0,o=r=e.children=this.combineJsxNodes(r,n);s<o.length;s++){var i=o[s];this.traverse(i,n)}this._enter(e,t)}},t}(),G=function(e,t){return new X(t).traverse(e)},M=l.default().use(p.default).freeze(),k=M().use(a.default).freeze(),Z=["body","comments","tokens"],$=["export","import","jsx"],q=["column","lineNumber"],I=[".mdx"],D=[".md"],W={comment:!0,ecmaFeatures:{jsx:!0},ecmaVersion:(new Date).getUTCFullYear(),sourceType:"module",tokens:!0,filePath:"__placeholder__.mdx",loc:!0,range:!0},H="<$>".length,B=function(){function t(){this._options=W,this.parse=this.parse.bind(this),this.parseForESLint=this.parseForESLint.bind(this)}return t.prototype.normalizeJsxNode=function(t,r,n){void 0===n&&(n=this._options);var s=t.value;if("jsx"!==t.type||w(s))return t;if(R.exec(s)){var o=[],i=t.position.start,a=i.line,p=i.column,l=i.offset,u=t.data;Object.assign(t,{data:e.__assign(e.__assign({},u),{jsxType:"JSXElementWithHTMLComments",comments:o,inline:!!r&&"root"!==r.type}),value:s.replace(C,(function(e,t,r,n,i){var u=i+e.length,c=s.slice(0,i).split("\n"),f=s.slice(0,u).split("\n"),m="{/"+"*".repeat(t.length-2)+r+"*".repeat(n.length-2)+"/}",x=c.length-1,h=f.length-1;return o.push({fixed:m,loc:{start:{line:a+x,column:g(c).length+(x?0:p-1),offset:l+i},end:{line:a+h,column:g(f).length+(h?0:p-1),offset:l+u}},origin:e}),m}))})}return this._normalizeJsxNodes(t,n)},t.prototype.parse=function(e,t){return this.parseForESLint(e,t).ast},t.prototype.parseForESLint=function(t,r){var n=this,s=i.default.extname(r.filePath),o=I.concat(r.extensions||[]).includes(s),a=D.concat(r.markdownExtensions||[]).includes(s);if(!o&&!a)return this._eslintParse(t,r);var p=(o?k:M).parse(t);return this._ast=e.__assign(e.__assign({},x(p.position)),{type:"Program",sourceType:r.sourceType||"module",body:[],comments:[],tokens:[]}),this._services={JSXElementsWithHTMLComments:[]},o&&G(p,{code:t,enter:function(e,s){if($.includes(e.type))for(var o=0,i=v(n.normalizeJsxNode(e,s,r));o<i.length;o++){var a=i[o];n._nodeToAst(t,a,r)}}}),{ast:this._ast,services:this._services}},t.prototype._eslintParse=function(e,t){var r,n;this._parsers&&t.parser===this._options.parser||(this._parsers=m(t.parser)),t.filePath&&this._options!==t&&Object.assign(this._options,t);for(var s=0,o=this._parsers;s<o.length;s++){var i=o[s];try{r=i(e,this._options);break}catch(e){n||(n=e)}}if(!r&&n)throw n;return"ast"in r&&r.ast?r:{ast:r}},t.prototype._normalizeJsxNodes=function(e,t){var r,n=e.value;try{r=this._eslintParse("<$>"+n+"</$>",t).ast}catch(t){if(h(t,q)){var s=e.position.start;throw"index"in t?t.index+=s.offset-H:"pos"in t&&(t.pos+=s.offset-H),t.column=t.lineNumber>1?t.column:t.column+s.column-H,t.lineNumber+=s.line-1,t}return e}var o=r.body[0].expression;if(!f(o)||o.children.length<=1)return e;var i=e.position.start,a=i.line,p=i.offset,l=e.data;return o.children.reduce((function(e,t){if(!f(t))return e;var r=t.start,s=t.end,o=t.loc,i=void 0===o?{start:{column:r,line:1},end:{column:s,line:1}}:o,u=i.start,c=i.end,m=t.range,x=void 0===m?[r,s]:m,h=a+u.line-1,d=a+c.line-1,_=x[0]-H,v=x[1]-H;return e.push({type:"jsx",data:e.length>0?null:l,value:n.slice(_,v),position:{start:{line:h,column:a===h?u.column-H:u.column,offset:p+_},end:{line:d,column:a===h?c.column-H:c.column,offset:p+v}}}),e}),[])},t.prototype._nodeToAst=function(e,t,r){var n;t.data&&"JSXElementWithHTMLComments"===t.data.jsxType&&this._services.JSXElementsWithHTMLComments.push(t);var s=t.value,o=x(t.position),i=o.loc,a=o.start,p=o.end;if(w(s)){var l=R.exec(s)[2];this._ast.comments.push({type:"Block",value:l,loc:i,range:[a,p]})}else{var u,c=i.start.line-1;try{u=this._eslintParse(s,r).ast}catch(e){throw h(e,q)&&(e.index+=a,e.column=e.lineNumber>1?e.column:e.column+i.start.column,e.lineNumber+=c),e}for(var f={line:c,column:d(e,a).column,offset:a},m=0,v=Z;m<v.length;m++){var g=v[m];(n=this._ast[g]).push.apply(n,u[g].map((function(e){return _(e,f)})))}}},t}(),U=new B,Y=U.parse,K=U.parseForESLint;exports.AST_PROPS=Z,exports.CLOSE_TAG_REGEX=O,exports.COMMENT_CONTENT_REGEX=R,exports.COMMENT_CONTENT_REGEX_GLOBAL=C,exports.COMMENT_REGEX=P,exports.DEFAULT_EXTENSIONS=I,exports.DEFAULT_PARSER_OPTIONS=W,exports.ES_NODE_TYPES=$,exports.FALLBACK_PARSERS=u,exports.JSX_TYPES=c,exports.LOC_ERROR_PROPERTIES=q,exports.MARKDOWN_EXTENSIONS=D,exports.OPEN_CLOSE_TAG_REGEX=L,exports.OPEN_TAG_REGEX=b,exports.Parser=B,exports.SELF_CLOSING_TAG_REGEX=A,exports.Traverse=X,exports.arrayify=v,exports.closeTag=S,exports.comment=N,exports.commentClose="(-*--\x3e)",exports.commentContent="(\x3c!---*)([\\s\\S]*?)(-*--\x3e)",exports.commentOpen="(\x3c!---*)",exports.first=function(e){return e&&e[0]},exports.getPositionAt=d,exports.hasProperties=h,exports.isCloseTag=j,exports.isComment=w,exports.isJsxNode=f,exports.isOpenCloseTag=z,exports.isOpenTag=J,exports.isSelfClosingTag=F,exports.last=g,exports.mdProcessor=M,exports.mdxProcessor=k,exports.normalizeParser=m,exports.normalizePosition=x,exports.openTag=y,exports.parse=Y,exports.parseForESLint=K,exports.parser=U,exports.restoreNodeLocation=_,exports.selfClosingTag=T,exports.traverse=G;
